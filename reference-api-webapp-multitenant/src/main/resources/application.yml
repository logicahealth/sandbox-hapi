server:
  port: ${API_PORT:8075}
  tomcat:
    remote_ip_header: x-forwarded-for
    protocol_header: x-forwarded-proto

spring:
  application:
    name: HSPC Reference API
  profiles:
    active: multitenant,dstu2
  datasource:
    initialSize: 1
    maxActive: 5

hibernate:
  search:
    default:
      indexBase: target/@artifact.name@/lucenefiles

logging:
  level:
    org.springframework.security: INFO

# Platform Servers
hspc:
  platform:
    api:
      security:
        # determines if security is applied at the contextPath
        mode: secured
#        mode: mock
#        mode: open
      oauth2:
        clientId: hspc_resource_server
        clientSecret: secret
        scopes: openid,launch,smart/orchestrate_launch
      sandbox:
        name: ${SANDBOX_NAME:hspc5}
      fhir:
        db:
          schema: hspc_5_${hspc.platform.api.sandbox.name}
          driver-class-name: com.mysql.jdbc.Driver
          host: ${DB_HOST:localhost}
          url: jdbc:mysql://${hspc.platform.api.fhir.db.host}:${DB_PORT:3306}/${hspc.platform.api.fhir.db.schema}
          username: ${DB_USER:root}
          password: ${DB_PASSWORD:password}
        datasource:
          cache:
            size: 40
        defaultTenantId: ${hspc.platform.api.sandbox.name}
        hibernate:
          dialect: org.hibernate.dialect.MySQL5Dialect
        terminology:
          proxy:
            host: api-v5-stu3.hspconsortium.org/${hspc.platform.api.sandbox.name}
            contextPath: /open
        federatedEndpointURL: dataphoria.org/datafhir
        contextPath: data
        # remove openContextPath to disable the open endpoint
        openContextPath: open
    # these values are used for internal calls to the auth server
    authorization:
      protocol: http
      host: ${AUTH_HOST:localhost}
      port: ${AUTH_PORT:8060}
      context: ~
      url: ${hspc.platform.authorization.protocol}://${hspc.platform.authorization.host}:${hspc.platform.authorization.port}${hspc.platform.authorization.context}
      authorizeUrl: ${hspc.platform.authorization.url}/authorize
      tokenUrl: ${hspc.platform.authorization.url}/token
      tokenCheckUrl: ${hspc.platform.authorization.url}/introspect
      userinfoUrl: ${hspc.platform.authorization.url}/userinfo
      smart:
        launchUrl: ${hspc.platform.authorization.url}/Launch
        registrationEndpointUrl: ${hspc.platform.authorization.url}/register
        urisEndpointExtensionUrl: http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris
        launchRegistrationUrl: /${hspc.platform.api.fhir.contextPath}/_services/smart/Launch
    # the manifest output should contain these values
    manifest:
      protocol: http
      default_host: ${hspc.platform.authorization.host}
      host: ${PUBLISHED_AUTH_HOST:}
      port: ${PUBLISHED_PORT:8060}
      context: ~
      url: ${hspc.platform.manifest.protocol}://${hspc.platform.manifest.host}:${hspc.platform.manifest.port}${hspc.platform.manifest.context}
      authorizeUrl: ${hspc.platform.manifest.url}/authorize
      tokenUrl: ${hspc.platform.manifest.url}/token
      smart:
        launchUrl: ${hspc.platform.manifest.url}/Launch
        registrationEndpointUrl: ${hspc.platform.manifest.url}/register
        urisEndpointExtensionUrl: http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris
        launchRegistrationUrl: /${hspc.platform.api.fhir.contextPath}/_services/smart/Launch
      security:
        authorize: ${hspc.platform.manifest.authorizeUrl}
        token: ${hspc.platform.manifest.tokenUrl}
        register: ${hspc.platform.manifest.smart.registrationEndpointUrl}
        launch-registration: ${hspc.platform.manifest.smart.launchRegistrationUrl}

---

spring:
  profiles: dstu2

hspc:
  platform:
    api:
      sandbox:
        name: ${SANDBOX_NAME:hspc5}
server:
  port: ${API_PORT:8075}

---

spring:
  profiles: stu3

hspc:
  platform:
    api:
      sandbox:
        name: ${SANDBOX_NAME:hspc6}
server:
  port: ${API_PORT:8076}

---

spring:
  profiles: r4

hspc:
  platform:
    api:
      sandbox:
        name: ${SANDBOX_NAME:hspc7}
server:
  port: ${API_PORT:8077}
